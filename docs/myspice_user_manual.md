# MySpice 用户手册

本文档面向使用 MySpice 的用户，介绍基本使用流程、命令行模式以及如何读取仿真输出。当前版本以 DC 与 TRAN 的基本流程为目标，随着功能完善会持续更新。

## 1. 快速开始

### 1.1 准备 netlist

MySpice 使用 SPICE 风格网表文件作为输入。示例:

```
* Basic DC example
V1 in 0 DC 1
R1 in out 1k
R2 out 0 2k
.op
.end
```

保存为 `example.cir`。

### 1.2 运行仿真

当前的二进制入口为 `sim-cli`:

```
sim-cli example.cir
```

运行成功会打印解析信息。后续版本将输出实际仿真结果。

---

## 2. 命令行模式 (Binary Mode)

### 2.1 基本语法

```
sim-cli <netlist>
```

- `<netlist>`: SPICE 网表文件路径  
- 网表必须包含 `.end`

### 2.3 当前解析能力说明

当前 parser 为 skeleton 版本，具备以下能力:

- 行级解析与续行拼接
- 识别注释行与空行
- 识别控制语句与器件语句
- 抽取器件节点与值/模型 (简化规则)
- 参数按 `key=value` 形式抽取
- 识别 `.param` / `.model` / `.subckt` (基础字段)
- 部分器件节点与字段的基础校验
- 支持 `.include` 递归读取 (基础版)
- 支持子电路基础展开与参数映射 (简单覆盖规则)
- 支持基础参数表达式求值 (加减乘除与括号，支持单位后缀)
- 受控源 E/G 支持 POLY 语法的基础识别
- 支持嵌套子电路基础展开

注意:

- 节点数量与字段语义尚未严格校验
- 参数表达式与更复杂的作用域规则将在后续阶段完善

### 2.2 批量运行 (spice-datasets)

项目支持批量运行 `spice-datasets` 中的网表，用于 smoke test:

```
python tests/run_spice_datasets.py
```

执行后会输出通过率，例如:

```
total=50 passed=50 failed=0 passrate=100.00%
```

---

## 3. 仿真结果查看

当前阶段结果仅用于流程验证。未来输出将支持:

- OP/DC/TRAN 的节点电压与器件电流
- 波形数据查询与导出
- PSF 文本格式输出

### 3.1 结果解读建议 (未来支持)

- OP: 查看静态工作点电压与电流
- DC Sweep: 查看参数扫描曲线
- TRAN: 查看时域波形

---

## 4. 常见问题

### 4.1 提示缺少 .end

确保网表末尾有 `.end` 行。

### 4.2 无输出结果

当前版本为架构搭建阶段，仿真结果还未实现。只要能运行通过即可。

---

## 5. 版本说明

手册会与项目阶段同步更新。后续将补充:

- 仿真结果字段说明
- 交互式 API 使用方法
- CLI 与 AI 代理的使用示例
